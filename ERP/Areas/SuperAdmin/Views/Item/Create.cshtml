@model Business.Entities.Master.ItemMaster
@{
    ViewData["Title"] = "Item";
    Layout = "~/Views/Shared/_LayoutMaster.cshtml";
}
<style>
    fieldset {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
        background-color: #ccc;
    }

    legend {
        font-weight: bold;
        border: 1px solid #ccc;
        border-radius: 25px;
        background-color: #7969ba;
        margin: -30px 0px 20px 25%;
        width: 50%;
        text-align: center;
        color: black;
    }

    .box {
        width: 160px;
        height: 160px;
        margin: 0 auto;
    }
</style>
<div class="page-breadcrumb d-none d-sm-flex align-items-center pb-3 border-bottom">
    <div class="ps-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 p-0">
                <li class="breadcrumb-item">
                    <a asp-controller="Home" asp-action="Index" asp-area="SuperAdmin"><i class="bx bx-home-alt"></i></a>
                </li>
                <li class="breadcrumb-item active" aria-current="page"><a asp-controller="Item" asp-action="Index" asp-area="SuperAdmin">Item</a></li>
                <li class="breadcrumb-item active" aria-current="page">Create</li>
            </ol>
        </nav>
    </div>
</div>
<div class="row">
    <form method="post" id="frmItem" asp-area="SuperAdmin" class="g-3 needs-validation" novalidate>
        <div class="mt-3">
            <div class="row">
                <div class="row">
                    <div class="col-md-8">
                        <div class="col-md-12">
                            <div class="mb-3 row">
                                <div class="col-md-4">
                                    <label for="ItemGroupID" class="col-form-label">Item Group<span class="required">*</span></label>
                                </div>
                                <div class="col-md-8">
                                    <select asp-for="ItemGroupID" asp-items="ViewBag.SubGroup" class="form-control">
                                        <option value="">Select Item Group...</option>
                                    </select>
                                    <span asp-validation-for="ItemGroupID" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3 row">
                                <input type="hidden" asp-for="ItemID" />
                                <div class="col-md-4">
                                    <label for="ItemSubGroupID" class="col-form-label">Item Sub Group<span class="required">*</span></label>
                                </div>
                                <div class="col-md-8">
                                    <select asp-for="ItemSubGroupID" asp-items="@ViewBag.ItemSubGroup" class="form-control">
                                        <option value="">Select Item Sub Group...</option>
                                    </select>
                                    <span asp-validation-for="ItemSubGroupID" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3 row">
                                <div class="col-md-4">
                                    <label for="roleName" class="col-form-label">Item Name<span class="required">*</span></label>
                                </div>
                                <div class="col-md-8">
                                    <input type="text" required="" class="form-control" asp-for="ItemName" maxlength="50">
                                    <span asp-validation-for="ItemName" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class=" col-form-label">Item Code<span class="required">*</span></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="ItemCode" name="ItemCode" asp-for="ItemCode">
                                    <span asp-validation-for="ItemCode" class="text-danger "></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <fieldset>
                                    <legend style="">QR Code</legend>
                                    <div class="box">
                                        <img src="https://chart.googleapis.com/chart?cht=qr&chl=&chs=160x160&chld=L|0"
                                             class="qr-code img-thumbnail img-responsive" />
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Description<span class="required">*</span></label>
                    </div>
                    <div class="col-md-9" style="">
                        <textarea rows="5" cols="20" class="form-control" id="Description" name="Description" data-val="true" data-val-required="Please enter description"></textarea>
                        <span class="text-danger  field-validation-valid" data-valmsg-for="Description" data-valmsg-replace="true"></span>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Client Item Name</label>
                    </div>
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="ClientItemName" name="ClientItemName" value="" fdprocessedid="a6a9n6">
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label for="UOMID" class="col-form-label">UOM<span class="required">*</span></label>
                    </div>
                    <div class="col-md-4">
                        <select asp-for="UOMID" asp-items="ViewBag.UOMID" class="form-control">
                            <option value="">Select UOM</option>
                        </select>
                        <span asp-validation-for="UOMID" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label for="IsGST" class="col-form-label">Is GST Included</label>
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" class="form-check-input" asp-for="IsGST" data-on-text="Yes" data-off-text="No" />
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Min Level Qty</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="MinLevel" name="MinLevel" asp-for="MinLevel" />
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" style="float:right;">Max Level Qty</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="MaxLevel" name="MaxLevel" asp-for="MaxLevel" />
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Re-order Level Qty</label>
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="ReorderLevel" name="ReorderLevel" asp-for="ReorderLevel" />
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Year Opening Balance</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="OpeningBalance" name="OpeningBalance" asp-for="OpeningBalance" />
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" style="float:right;">Current Balance</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="Rate" name="Rate" asp-for="Rate" />
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label">Chapter Header No</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="ChapterHeaderNo" name="ChapterHeaderNo" asp-for="ChapterHeaderNo" />
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" style="float:right;">Comodity Code</label>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="ComodityCode" name="ComodityCode" asp-for="ComodityCode" />
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label for="DefaultLocationID" class="col-form-label">Primary Location<span class="required">*</span></label>
                    </div>
                    <div class="col-md-6">
                        <select asp-for="DefaultLocationID" asp-items="@ViewBag.PrimaryLocation" class="form-control">
                            <option value="">Select primary location</option>
                        </select>
                        <span asp-validation-for="DefaultLocationID" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="row">
                    <div class="col-md-3">
                        <label for="WareHouseID" class="col-form-label">Primary Warehouse<span class="required">*</span></label>
                    </div>
                    <div class="col-md-6">
                        <select asp-for="WareHouseID" asp-items="@ViewBag.WareHouse" class="form-control">
                            <option value="">Select primary warehouse</option>
                        </select>
                        <span asp-validation-for="WareHouseID" class="text-danger"></span>
                    </div>
                </div>
            </div>
            @* <div class="row mb-3">
            <label for="IsActive" class="col-sm-3 col-form-label text-end">Status</label>
            <div class="col-sm-9">
            <input type="checkbox" class="form-check-input" asp-for="IsActive" data-on-text="Yes" data-off-text="No" />
            </div>
            </div>*@
            <div>
                <button class="btn btn-primary btn-info px-5 ladda-button" id="btnSave" type="button" onclick="fnSubmit()">
                    Submit
                </button>
                <button type="button" onclick="GoBack()" class="btn btn-primary btn-info px-5">Back</button>
                <button type="reset" class="btn btn-default btn-info px-5 ladda-button" onclick="fnReset()">Clear</button>
                <div class="clear">&nbsp;</div>
                <button type="button" id="btnBill" class="btn btn-primary btn-info px-5 ladda-button">Create Bill of material</button>
            </div>
        </div>
    </form>
</div>
@await Html.PartialAsync("_ValidationScriptsPartial")
<script type="text/javascript">
    (function ($) {

        //re-set all client validation given a jQuery selected form or child
        $.fn.resetValidation = function () {

            var $form = this.closest('form');

            //reset jQuery Validate's internals
            $form.validate().resetForm();

            //reset unobtrusive validation summary, if it exists
            $form.find("[data-valmsg-summary=true]")
                .removeClass("validation-summary-errors")
                .addClass("validation-summary-valid")
                .find("ul").empty();

            //reset unobtrusive field level, if it exists
            $form.find("[data-valmsg-replace]")
                .removeClass("field-validation-error")
                .addClass("field-validation-valid")
                .empty();

            return $form;
        };
    })(jQuery);
    function fnReset() {
        var $form = $("#frmItem");
        $form[0].reset();
        $form.resetValidation();
    }
    function GoBack(){
        window.location.href = '@Url.Action("Index","Item")';
    }
    function fnSubmit() {
        if ($("#frmItem").valid()) {
            var l = laddaStart('btnSave');
            var urlSave = '@Url.Action("Save","Item")';
            modeldata = $("#frmItem").serialize();
            alert(modeldata);
            alert(l);
            $.ajax({
                type: 'POST',
                url: urlSave, ////'../SuperAdmin/Item/Save',
                data: modeldata,
                dataType: 'json',
                beforeSend: function () { },
                success: function (data) {
                    console.log(data.status);
                    if (data.status) {
                        //notification
                        //$("#canvas_item").hide();//('hide');
                        Lobibox.notify('success', {
                            pauseDelayOnHover: true,
                            size: 'mini',
                            icon: 'bx bx-check-circle',
                            continueDelayOnInactiveTab: false,
                            position: 'bottom right',
                            msg: data.message
                        });
                    }
                    else {
                        Lobibox.notify('error', {
                            pauseDelayOnHover: true,
                            size: 'mini',
                            icon: 'bx bx-check-circle',
                            continueDelayOnInactiveTab: false,
                            position: 'bottom right',
                            msg: data.message
                        });
                    }
                },
                error: function (error) {
                    laddaStop(l);
                    Lobibox.notify('error', {
                        pauseDelayOnHover: true,
                        size: 'mini',
                        icon: 'bx bx-check-circle',
                        continueDelayOnInactiveTab: false,
                        position: 'bottom right',
                        msg: "@MessageHelper.Error"
                    });
                }
            }).always(function () {
                hideLoader();
            });
        }
    };
</script>
<script>
    // Function to HTML encode the text
    // This creates a new hidden element,
    // inserts the given text into it
    // and outputs it out as HTML
    function htmlEncode(value) {
        return $('<div/>').text(value)
            .html();
    }

    $(function () {

        // Specify an onclick function
        // for the generate button
        $('#ItemCode').blur(function () {
            // Generate the link that would be
            // used to generate the QR Code
            // with the given data
            let finalURL =
                'https://chart.googleapis.com/chart?cht=qr&chl=' +
                htmlEncode($('#ItemCode').val()) +
                '&chs=260x260&chld=L|0'

            // Replace the src of the image with
            // the QR code image
            $('.qr-code').attr('src', finalURL);
        });
    });
</script>